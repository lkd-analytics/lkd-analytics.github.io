---
title: '`volleystat` R Package Reviewwww'
date: "2024-01-31 16:00:00 +/-1100"
categories: [sport_analytics, volleyball]
output:
  md_document:
    variant: markdown_github
    preserve_yaml: yes
  pdf_document: default
  github_document: default
tags: [volleyball]
always_allow_html: true
---

------------------------------------------------------------------------

## 1. Open Source Data: Overview

### 1.1 Datasets and variables

The `volleystat` package is an open-source statistics repository for the
Men & Female German Bundesliga Volleyball League (1st Division) created
by [Viktor Bozhinov](https://github.com/bozhinvi). The package contain
the following datasets/dataframes, including: *matches, matchstats,
match_addresses, players, sets, staff,* and *team_addresses.*

For example, here are some of the variables included in the *players*
and *sets* dataframes:

<table class="table table-striped table-hover table-condensed" style="color: black; margin-left: auto; margin-right: auto;">
<caption>
Player Data
</caption>
<thead>
<tr>
<th style="text-align:center;">
season_id
</th>
<th style="text-align:center;">
league_gender
</th>
<th style="text-align:center;">
team_id
</th>
<th style="text-align:center;">
team_name
</th>
<th style="text-align:center;">
lastname
</th>
<th style="text-align:center;">
firstname
</th>
<th style="text-align:center;">
height
</th>
<th style="text-align:center;">
gender
</th>
<th style="text-align:center;">
birthdate
</th>
<th style="text-align:center;">
shirt_number
</th>
<th style="text-align:center;">
position
</th>
<th style="text-align:center;">
nationality
</th>
<th style="text-align:center;">
player_id
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1617
</td>
<td style="text-align:center;">
Men
</td>
<td style="text-align:center;">
1001
</td>
<td style="text-align:center;">
Solingen Volleys
</td>
<td style="text-align:center;">
Bevers
</td>
<td style="text-align:center;">
Lennart
</td>
<td style="text-align:center;">
179
</td>
<td style="text-align:center;">
male
</td>
<td style="text-align:center;">
1993-07-10
</td>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
Libero
</td>
<td style="text-align:center;">
Germany
</td>
<td style="text-align:center;">
10
</td>
</tr>
<tr>
<td style="text-align:center;">
1617
</td>
<td style="text-align:center;">
Men
</td>
<td style="text-align:center;">
1001
</td>
<td style="text-align:center;">
Solingen Volleys
</td>
<td style="text-align:center;">
den Boer
</td>
<td style="text-align:center;">
Huib
</td>
<td style="text-align:center;">
191
</td>
<td style="text-align:center;">
male
</td>
<td style="text-align:center;">
1981-11-11
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
Setter
</td>
<td style="text-align:center;">
Netherlands
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
1617
</td>
<td style="text-align:center;">
Men
</td>
<td style="text-align:center;">
1001
</td>
<td style="text-align:center;">
Solingen Volleys
</td>
<td style="text-align:center;">
Gies
</td>
<td style="text-align:center;">
Oliver
</td>
<td style="text-align:center;">
197
</td>
<td style="text-align:center;">
male
</td>
<td style="text-align:center;">
1985-06-28
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
Outside spiker
</td>
<td style="text-align:center;">
Germany
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
1617
</td>
<td style="text-align:center;">
Men
</td>
<td style="text-align:center;">
1001
</td>
<td style="text-align:center;">
Solingen Volleys
</td>
<td style="text-align:center;">
Gosmann
</td>
<td style="text-align:center;">
Christian
</td>
<td style="text-align:center;">
191
</td>
<td style="text-align:center;">
male
</td>
<td style="text-align:center;">
1992-07-02
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
Universal
</td>
<td style="text-align:center;">
Germany
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:center;">
1617
</td>
<td style="text-align:center;">
Men
</td>
<td style="text-align:center;">
1001
</td>
<td style="text-align:center;">
Solingen Volleys
</td>
<td style="text-align:center;">
Horn
</td>
<td style="text-align:center;">
Maximilian
</td>
<td style="text-align:center;">
188
</td>
<td style="text-align:center;">
male
</td>
<td style="text-align:center;">
1996-08-07
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
Setter
</td>
<td style="text-align:center;">
Germany
</td>
<td style="text-align:center;">
4
</td>
</tr>
</tbody>
</table>
<table class="table table-striped table-hover table-condensed" style="color: black; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
league_gender
</th>
<th style="text-align:center;">
season_id
</th>
<th style="text-align:center;">
match_id
</th>
<th style="text-align:center;">
match
</th>
<th style="text-align:center;">
team_id
</th>
<th style="text-align:center;">
team_name
</th>
<th style="text-align:center;">
set
</th>
<th style="text-align:center;">
set_duration
</th>
<th style="text-align:center;">
pt_set
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
Women
</td>
<td style="text-align:center;">
1314
</td>
<td style="text-align:center;">
2003
</td>
<td style="text-align:center;">
home
</td>
<td style="text-align:center;">
2001
</td>
<td style="text-align:center;">
Allianz MTV Stuttgart
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
18
</td>
</tr>
<tr>
<td style="text-align:center;">
Women
</td>
<td style="text-align:center;">
1314
</td>
<td style="text-align:center;">
2002
</td>
<td style="text-align:center;">
home
</td>
<td style="text-align:center;">
2002
</td>
<td style="text-align:center;">
Dresdner SC
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
23
</td>
<td style="text-align:center;">
25
</td>
</tr>
<tr>
<td style="text-align:center;">
Women
</td>
<td style="text-align:center;">
1314
</td>
<td style="text-align:center;">
2004
</td>
<td style="text-align:center;">
home
</td>
<td style="text-align:center;">
2008
</td>
<td style="text-align:center;">
USC MÃ¼nster
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
22
</td>
</tr>
<tr>
<td style="text-align:center;">
Women
</td>
<td style="text-align:center;">
1314
</td>
<td style="text-align:center;">
2001
</td>
<td style="text-align:center;">
home
</td>
<td style="text-align:center;">
2005
</td>
<td style="text-align:center;">
Rote Raben Vilsbiburg
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
26
</td>
</tr>
<tr>
<td style="text-align:center;">
Women
</td>
<td style="text-align:center;">
1314
</td>
<td style="text-align:center;">
2005
</td>
<td style="text-align:center;">
home
</td>
<td style="text-align:center;">
2009
</td>
<td style="text-align:center;">
VC Wiesbaden
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
19
</td>
<td style="text-align:center;">
25
</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

### 1.2 Data Source

The data was collected from the official [Bundesliga Volleyball
website](https://www.volleyball-bundesliga.de/). It covers the games
played from the 2013/14 to the 2018/19 season.  

Specfically, the in-game match statistics were collected/scraped
directly from official game reports using the
[`tabulizer`](https://cran.r-hub.io/web/packages/tabulizer/vignettes/tabulizer.html)
package:

<center>
<details>
<summary>
Example game report:
</summary>
![](assets/images/volleyball/volleystat_review/match_report_example.png)
</details>
</center>

------------------------------------------------------------------------

### 1.3 Accessing the data

Accessing the data is quite straightforward, as the datasets are
directly accessible from the `volleystat` package itself. Therefore you
can either access the dataset directly:

``` r
volleystat::matches
volleystat::matchstats
volleystat::players
# and so on...
```

Unfortunately, one limitation of this package is that the data is
scraped directly from the game reports (.pdf), therefore, the package
will only be updated with new data once the package creator manually
scrapes recent games and uploads them.

------------------------------------------------------------------------

### 1.4 Appraisal

As the `volleystat` package contains multiple variables, there are
multiple research questions that can be produced, for example:

-   *Is there a relationship between longer match/set times and player
    metrics?*
    -   Using player metrics from the *matchstats* dataset and
        `match_duration`/`set_duration` from the *matches*/*sets*
        datasets respectively, we can discover any correlations for
        specific player metrics.
-   *What player metrics best predict match outcome?*
    -   We can create a new variable, match outcome, which can be used
        as a dependent variable in a predictive model using player
        metrics from *matchstats* as our predictor variables.
-   *Does playing at home, time of match and spectator count influence
    match outcome?*
    -   Variables for home or away, match time and spectator count can
        be extracted from the *matches* dataset, which can then be
        compared to a match outcome variable (created via data
        manipulation).

Unfortunately, the `volleystat` package does not include hawkeye-like
data containing x,y co-ordinates of the ball, nor any LPS/Optical
tracking data for player position on the court.  

Not having access to this data makes it difficult/impossible to analyse
parts of the games such as:

-   setter choice/selection
-   spike choice/selection
-   service choice/selection
-   defence formation on attack

------------------------------------------------------------------------

### 1.5 Visualisations

This section will demonstrate what types of visualisations can be
created through manipulation of data obtained from the `volleystat`
package (all visualisations were made with the package `ggplot2`).

To add context, a table of metric definitions has been provided below.

<table class="table table-striped table-hover table-condensed" style="color: black; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Metric definitions
</caption>
<thead>
<tr>
<th style="text-align:left;">
metrics
</th>
<th style="text-align:left;">
descriptions
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
pt_total
</td>
<td style="text-align:left;">
Total points scored
</td>
</tr>
<tr>
<td style="text-align:left;">
serv_total
</td>
<td style="text-align:left;">
Total number of serves
</td>
</tr>
<tr>
<td style="text-align:left;">
aces
</td>
<td style="text-align:left;">
Total number of service aces
</td>
</tr>
<tr>
<td style="text-align:left;">
serv_error
</td>
<td style="text-align:left;">
Total number of service errors
</td>
</tr>
<tr>
<td style="text-align:left;">
rec_total
</td>
<td style="text-align:left;">
Total number of receptions from serve
</td>
</tr>
<tr>
<td style="text-align:left;">
rec_error
</td>
<td style="text-align:left;">
Total number of receptions errors
</td>
</tr>
<tr>
<td style="text-align:left;">
att_total
</td>
<td style="text-align:left;">
Total number of attacks/spikes
</td>
</tr>
<tr>
<td style="text-align:left;">
att_error
</td>
<td style="text-align:left;">
Total number of attacking errors
</td>
</tr>
<tr>
<td style="text-align:left;">
att_block
</td>
<td style="text-align:left;">
Total number of blocks
</td>
</tr>
<tr>
<td style="text-align:left;">
att_pt
</td>
<td style="text-align:left;">
Total number of successful attacks
</td>
</tr>
<tr>
<td style="text-align:left;">
block_pt
</td>
<td style="text-align:left;">
Total number of successful blocks
</td>
</tr>
</tbody>
</table>

### Metric Definitions

<center>
![](https://i.imgur.com/h6JaMqQ.png)
</center>

``` r
top3_bottom3_1819_men <- team_stats_long %>% 
  filter(league_gender.x == 'Men',
                team_name %in% c('Berlin Recycling Volleys',
                                 'VfB Friedrichshafen',
                                 'Hypo Tirol AlpenVolleys Haching',
                                 'VCO Berlin',
                                 'TV Rottenburg',
                                 'Helios Grizzlys Giesen'),
                season_id =='18/19') %>% 
  # Add final seed to name for legend
  mutate(team_name = case_when(team_name == 'Berlin Recycling Volleys' ~ 'Berlin Recycling Volleys (1)',
                               team_name == 'VfB Friedrichshafen' ~ 'VfB Friedrichshafen (2)',
                               team_name == 'Hypo Tirol AlpenVolleys Haching' ~ 'Hypo Tirol AlpenVolleys Haching (3)',
                               team_name == 'Helios Grizzlys Giesen' ~ 'Helios Grizzlys Giesen (10)',
                               team_name == 'TV Rottenburg' ~ 'TV Rottenburg (11)',
                               team_name == 'VCO Berlin' ~ 'VCO Berlin (12)'),
         # Re-level for ordering in legend, weird ordering as legend is at the bottom
         team_name = factor(team_name, levels = c('Berlin Recycling Volleys (1)',
                                                  'Helios Grizzlys Giesen (10)',
                                                  'VfB Friedrichshafen (2)',
                                                  'TV Rottenburg (11)',
                                                  'Hypo Tirol AlpenVolleys Haching (3)',
                                                  'VCO Berlin (12)')),
         # Also re-level the abbreviated team names for the x-axis
         team_name_abrv = factor(team_name_abrv, levels = c('BrRV',
                                                            'VfBF',
                                                            'HTAH',
                                                            'HlGG',
                                                            'TVRt',
                                                            'VCOB'))) 
```

<details>
<summary>
This is the summary text, click me to expand
</summary>

This is the detailed text.

**And this Text should be bold.**

We can still use markdown, but we need to take the additional step of
using the `parse_block_html` option as described in the [Mix HTML +
Markdown Markup section](#mix-html--markdown-markup).

You can learn more about expected usage of this approach in the [GitLab
UI
docs](https://gitlab-org.gitlab.io/gitlab-ui/?path=/story/base-collapse--default)
though the solution we use above is specific to usage in markdown.

</details>
<center>
<details>
<summary>
Code for graphs:
</summary>

``` r
# some testing code here
```

</details>
</center>

``` r
ggplot(top3_bottom3_1819_men, aes(x = team_name_abrv, y = value, fill = team_name)) +
  geom_col() +
  facet_wrap(~pt_metrics, scales = 'free_y') +
  geom_hline(data = seas_avg_long %>% filter(league_gender.x == 'Men', season_id == '18/19'),
             aes(yintercept = avg, linetype = 'League Average'), linewidth = 0.7, col = '#54D421') +
  theme_bw() +
  theme(panel.grid.major.x = element_blank(),
        legend.position = 'bottom',
        legend.text = element_text(size = 11),
        legend.title = element_text(size = 13),
        axis.text = element_text(colour = 'black'),
        panel.background = element_rect(fill = '#f1f1f1')) +
  labs(fill = 'Team',
       linetype = '') + # change legend title
  ggtitle('Comparison of top 3 and bottom 3 teams for the 18/19 season, w/ league avg.') +
  ylab('') +
  xlab('') +
  scale_fill_manual(values = c("#375681", "#db571a", "#4972ab", "#E76E36", "#7092c2", "#EC895B")) +
  scale_linetype_manual(values = 5)
```

![](/assets/images/volleystat_review/unnamed-chunk-7-1.png)

``` r
  ggsci::scale_fill_d3()
```

    ## <ggproto object: Class ScaleDiscrete, Scale, gg>
    ##     aesthetics: fill
    ##     axis_order: function
    ##     break_info: function
    ##     break_positions: function
    ##     breaks: waiver
    ##     call: call
    ##     clone: function
    ##     dimension: function
    ##     drop: TRUE
    ##     expand: waiver
    ##     get_breaks: function
    ##     get_breaks_minor: function
    ##     get_labels: function
    ##     get_limits: function
    ##     guide: legend
    ##     is_discrete: function
    ##     is_empty: function
    ##     labels: waiver
    ##     limits: NULL
    ##     make_sec_title: function
    ##     make_title: function
    ##     map: function
    ##     map_df: function
    ##     n.breaks.cache: NULL
    ##     na.translate: TRUE
    ##     na.value: NA
    ##     name: waiver
    ##     palette: function
    ##     palette.cache: NULL
    ##     position: left
    ##     range: environment
    ##     rescale: function
    ##     reset: function
    ##     scale_name: d3
    ##     train: function
    ##     train_df: function
    ##     transform: function
    ##     transform_df: function
    ##     super:  <ggproto object: Class ScaleDiscrete, Scale, gg>

### Mens League

The team metric overview visualisation below provides an easy way to
interpret how well a teams metrics compare to the season average for a
given year. Depending on domain knowledge, this may provide a quick way
of determining which teams performed well for a season in the
Bundesliga.

------------------------------------------------------------------------
